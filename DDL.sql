DROP TABLE P_USER CASCADE CONSTRAINTS PURGE;
DROP TABLE P_CATEGORY CASCADE CONSTRAINTS PURGE;
DROP TABLE P_COMMENT CASCADE CONSTRAINTS PURGE;
DROP TABLE P_FAVOURITE CASCADE CONSTRAINTS PURGE;
DROP TABLE P_INGREDIENT_ITEM CASCADE CONSTRAINTS PURGE;
DROP TABLE P_INGREDIENT CASCADE CONSTRAINTS PURGE;
DROP TABLE P_RECIPE CASCADE CONSTRAINTS PURGE;

CREATE TABLE P_USER (	
   USER_ID INT GENERATED BY DEFAULT ON NULL AS IDENTITY,
   USER_NAME  VARCHAR2(50) NOT NULL,
   USER_EMAIL VARCHAR2(50) NOT NULL,
   CONSTRAINT USER_ID_PK PRIMARY KEY (USER_ID) ENABLE,
   CONSTRAINT USER_UNIQUE UNIQUE (USER_EMAIL),
   CONSTRAINT CHK_EMAIL CHECK (USER_EMAIL LIKE '%_@__%.__%')
);

CREATE TABLE P_CATEGORY (	
   CATEGORY_ID INT GENERATED BY DEFAULT ON NULL AS IDENTITY,
   CATEGORY_NAME  VARCHAR2(50) NOT NULL,
   DESCRIPTION VARCHAR2(100),
   CONSTRAINT CATEGORY_UNIQUE UNIQUE (CATEGORY_NAME),
   CONSTRAINT CATEGORY_ID_PK PRIMARY KEY (CATEGORY_ID) ENABLE
);

CREATE TABLE P_RECIPE (	
   RECIPE_ID INT GENERATED BY DEFAULT ON NULL AS IDENTITY,
   USER_ID INT NOT NULL,
   CATEGORY_ID INT NOT NULL,
   RECIPE_NAME VARCHAR2(50) NOT NULL, 
   COOKING_TIME VARCHAR2(5), 
   SERVING_NUM NUMBER NOT NULL,
   DESCRIPTION VARCHAR2(200) NOT NULL,
   CONSTRAINT RECIPE_ID_PK PRIMARY KEY (RECIPE_ID) ENABLE,
   CONSTRAINT RECIPE_USER_ID_FK FOREIGN KEY (USER_ID) REFERENCES P_USER(USER_ID),
   CONSTRAINT RECIPE_UNIQUE UNIQUE (RECIPE_NAME,USER_ID)
);

CREATE TABLE P_INGREDIENT (	
   ING_ID INT GENERATED BY DEFAULT ON NULL AS IDENTITY,
   ING_NAME VARCHAR2(50) NOT NULL, 
   CONSTRAINT ING_ID_PK PRIMARY KEY (ING_ID) ENABLE
);

CREATE TABLE P_INGREDIENT_ITEM (	
   ING_ID INT NOT NULL,
   RECIPE_ID INT NOT NULL,
   ING_QUANTITY NUMBER, 
   ING_UNIT VARCHAR2(10),
   CONSTRAINT ING_ITEM_PK PRIMARY KEY (ING_ID,RECIPE_ID) ENABLE,
   CONSTRAINT INGREDIENT_ING_ID_FK FOREIGN KEY (ING_ID) REFERENCES P_INGREDIENT(ING_ID),
   CONSTRAINT INGREDIENT_RECIPE_ID_FK FOREIGN KEY (RECIPE_ID) REFERENCES P_RECIPE(RECIPE_ID)
);

CREATE TABLE P_COMMENT (	
   COMMENT_ID INT GENERATED BY DEFAULT ON NULL AS IDENTITY,
   RECIPE_ID INT NOT NULL,
   USER_ID INT NOT NULL,
   RATING VARCHAR2(10),
   COMMENT_TXT VARCHAR2(100) NOT NULL,
   CONSTRAINT COMMENT_ID_PK PRIMARY KEY (COMMENT_ID) ENABLE,
   CONSTRAINT COMMENT_RECIPE_ID_FK FOREIGN KEY (RECIPE_ID) REFERENCES P_RECIPE(RECIPE_ID),
   CONSTRAINT COMMENT_USER_ID_FK FOREIGN KEY (USER_ID) REFERENCES P_USER(USER_ID)
);

CREATE TABLE P_FAVOURITE (	
   RECIPE_ID INT,
   USER_ID INT,
   CONSTRAINT FAVOURITE_PK PRIMARY KEY (RECIPE_ID,USER_ID) ENABLE,
   CONSTRAINT FAVOURITE_RECIPE_ID_FK FOREIGN KEY (RECIPE_ID) REFERENCES P_RECIPE(RECIPE_ID),
   CONSTRAINT FAVOURITE_USER_ID_FK FOREIGN KEY (USER_ID) REFERENCES P_USER(USER_ID)
);